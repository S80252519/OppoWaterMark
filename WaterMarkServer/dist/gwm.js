!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).gwm=e()}(this,function(){"use strict";var u=function(t){var e=t.txt,n=void 0===e?(new Date).toLocaleDateString()+" Top secret":e,r=t.x,o=void 0===r?0:r,i=t.y,a=void 0===i?50:i,s=t.font,c=void 0===s?"microsoft yahe":s,d=t.color,h=void 0===d?"#000":d,u=t.fontSize,l=void 0===u?12:u,f=t.alpha,p=void 0===f?.1:f,v=t.width,m=void 0===v?158:v,g=t.height,w=void 0===g?100:g,b=t.angle,y=void 0===b?-15:b;this.txt=n,this.width=m,this.height=w,this.x=o,this.y=a,this.font=c,this.fontSize=l,this.color=h,this.alpha=p,this.angle=y},l=(t.prototype.render=function(){var t=this.watermark,e=t.txt,n=t.x,r=t.y,o=t.width,i=t.height,a=t.font,s=t.color,c=t.fontSize,d=t.alpha,h=t.angle,u=this.canvas.getContext("2d");if(null===u)throw new Error("getContext error");return u.clearRect(0,0,o,i),u.textBaseline="top",u.textAlign="left",u.fillStyle=s,u.globalAlpha=d,u.font=c+"px "+a,u.translate(n,r),u.rotate(Math.PI/180*h),u.translate(-n,-r-c),u.fillText(e,n,r+c),this.canvas.toDataURL()},t);function t(t){var e=(this.watermark=t).width,n=t.height;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",""+e),this.canvas.setAttribute("height",""+n)}function f(n,r,o){return Object.keys(r).forEach(function(t){if("normal"!==o)if(n.style.setProperty)n.style.setProperty(t,r[t],"important");else if(n.setAttribute){var e="";null!==n.getAttribute("style")&&(e=e+" "+t+": "+r[t]+"!important"),n.setAttribute("style",e)}else n.style[t]=r[t];else n.style[t]=r[t]}),n}var p=(e.prototype._createItem=function(){var t=this.watermark,e=t.txt,n=t.x,r=t.y,o=t.font,i=t.color,a=t.fontSize,s=t.alpha,c=t.angle,d=t.width,h=t.height,u=document.createElement("div");f(u,{position:"relative",width:d,height:h,flex:"0 0 "+d+"px",overflow:"hidden",pointerEvents:"none"},"normal");var l=document.createElement("span");return l.innerHTML=e,f(l,{position:"absolute",top:r+"px",left:n+"px",fontFamily:o,fontSize:a+"px",color:i,lineHeight:1.5,opacity:s,fontWeight:400,transform:"rotate("+c+"deg)",transformOrigin:"0 0",userSelect:"none",whiteSpace:"nowrap",overflow:"hidden"},"normal"),u.appendChild(l),u},e.prototype.render=function(){var t=0,e=this.watermark,n=e.width,r=e.height,o=document.documentElement||document.body,i=o.clientWidth,a=o.clientHeight,s=Math.ceil(i/n),c=Math.ceil(a/r),d=document.createElement("div");for(f(d,{display:"flex",flexWrap:"wrap",width:n*s+"px",height:r*c+"px"},"normal");t<s*c;t++)d.appendChild(this._createItem());return d},e);function e(t){this.watermark=t}var v=(n.prototype.render=function(){var t=this.watermark,e=t.txt,n=t.x,r=t.y,o=t.width,i=t.height,a=t.color,s=t.font,c=t.fontSize,d='<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'px" height="'+i+'px">\n                <text x="'+n+'px" y="'+r+'px" dy="'+c+'px"\n                    text-anchor="start"\n                    stroke="'+a+'"\n                    stroke-opacity="'+t.alpha+'"\n                    fill="none"\n                    transform="rotate('+t.angle+","+n+" "+r+')"\n                    font-weight="100"\n                    font-size="'+c+'"\n                    font-family="'+s+'"\n                    >\n                    '+e+"\n                </text>\n            </svg>";return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)))},n);function n(t){this.watermark=t}var d=MutationObserver||WebKitMutationObserver||MozMutationObserver;function r(e,t,n){if(!d)return r=e,o=t,i=n,(a=["DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMElementNameChanged","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified"]).map(function(t){return r.addEventListener(t,function(){return i()},!1)}),document.body.addEventListener("DOMSubtreeModified",function(){return i()},!1),{containerObserver:{disconnect:function(){return o.removeEventListener("DOMSubtreeModified",function(){return i()},!1)}},targetObserver:{disconnect:function(){return a.map(function(t){return r.removeEventListener(t,function(){return i()},!1)})}}};var r,o,i,a,s=new d(function(t){t.forEach(function(t){t.removedNodes.forEach(function(t){t===e&&n()})})});s.observe(t,{childList:!0});var c=new MutationObserver(n);return c.observe(e,{characterData:!0,attributes:!0,childList:!0,subtree:!0}),{containerObserver:s,targetObserver:c}}function m(t){var e=t.gwmDom,n=t.opts.css;e&&e.remove();var r=document.createElement("div");return"pointerEvents"in document.documentElement.style&&(n.pointerEvents="none",n.zIndex=0<parseInt(""+n.zIndex,10)?n.zIndex:"999999"),f(r,n),r}var g="canvas",w="element",b={position:"fixed",top:0,right:0,bottom:0,left:0,overflow:"hidden",zIndex:-10,backgroundRepeat:"no-repeat",display:"block",opacity:"1"};function o(){}return new(o.prototype.creation=function(t){t.css=Object.assign({},b,t.css),this.opts=t,this.cancel();var e=t.mode,n=t.watch,r=t.container,o=void 0===r?document.body:r;this.wrap=function(t){if("string"!=typeof t)return t;var e=document.querySelector(t);return e||document.body}(o),this.wrap!==document.body&&(this.opts.css.position="absolute",f(this.wrap,{position:"relative"})),this.gwmDom=m(this);var i,a,s,c=new u(t),d=(a=c,s=[g,"svg",w],(i=e)&&(i=i.toLowerCase(),i=s.includes(i)?i:""),new((i=i||"svg")===g?l:"svg"===i?v:p)(a)).render();e===w?this.gwmDom.appendChild(d):this.gwmDom.style.background='url("'+d+'")';var h=this.wrap.firstChild;h?this.wrap.insertBefore(this.gwmDom,h):this.wrap.appendChild(this.gwmDom),!1!==n&&(this.observer=this.observing()),t.destroy&&(this.creation=function(t){return t})},o.prototype.observing=function(){var t=this;return r(this.gwmDom,this.wrap,function(){return t.creation(t.opts)})},o.prototype.cancel=function(){var t,e,n;this.observer&&(t=this.observer,e=t.containerObserver,n=t.targetObserver,e.disconnect(),n.disconnect())},o)});
